<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>𝗖𝗼𝗱𝗲𝗕𝗹𝗼𝗰𝗸𝘀 — Offline Block Editor</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      height: 100vh;
      user-select: none;
    }
    #palette {
      width: 250px;
      background: #f0f0f0;
      padding: 10px;
      box-sizing: border-box;
      border-right: 1px solid #ccc;
      overflow-y: auto;
    }
    #workspace {
      flex: 1;
      position: relative;
      background: #fff;
      overflow: auto;
    }
    .block {
      padding: 8px 12px;
      margin: 4px 0;
      border-radius: 8px;
      cursor: grab;
      color: white;
      font-weight: bold;
      position: absolute;
    }
    .palette-block {
      position: relative;
      cursor: grab;
    }
    .stack {
      display: block;
    }
    /* Block colors like Scratch categories */
    .motion { background: #4C97FF; }
    .looks { background: #9966FF; }
    .control { background: #FFAB19; }
    .sensing { background: #5CB1D6; }
    .operators { background: #59C059; }
    .variables { background: #FF8C1A; }
  </style>
</head>
<body>
  <div id="palette">
    <h3>Palette</h3>
    <div class="palette-block motion" data-type="move">move (10) steps</div>
    <div class="palette-block motion" data-type="turn">turn (15) degrees</div>
    <div class="palette-block looks" data-type="say">say “Hello!”</div>
    <div class="palette-block control" data-type="repeat">repeat (10) {/* ... */}</div>
    <div class="palette-block control" data-type="if">if <condition> then {/* ... */}</div>
    <div class="palette-block sensing" data-type="touching">touching (mouse-pointer)?</div>
    <div class="palette-block operators" data-type="add">(+ (1) (2))</div>
    <div class="palette-block variables" data-type="setVar">set [var] to (0)</div>
  </div>
  <div id="workspace"></div>

  <script>
    const palette = document.getElementById('palette');
    const workspace = document.getElementById('workspace');
    let dragItem = null;
    let offsetX = 0, offsetY = 0;

    palette.addEventListener('mousedown', e => {
      if (e.target.classList.contains('palette-block')) {
        const type = e.target.getAttribute('data-type');
        dragItem = e.target.cloneNode(true);
        dragItem.classList.remove('palette-block');
        dragItem.classList.add('block');
        dragItem.style.position = 'absolute';
        dragItem.style.left = e.pageX - palette.offsetWidth + 'px';
        dragItem.style.top = e.pageY + 'px';
        workspace.appendChild(dragItem);
        offsetX = e.offsetX;
        offsetY = e.offsetY;
      }
    });

    document.addEventListener('mousemove', e => {
      if (!dragItem) return;
      dragItem.style.left = (e.pageX - offsetX - palette.offsetWidth) + 'px';
      dragItem.style.top = (e.pageY - offsetY) + 'px';
    });

    document.addEventListener('mouseup', e => {
      if (!dragItem) return;
      // Snap to grid / stack logic
      const blocks = Array.from(workspace.querySelectorAll('.block')).filter(b => b !== dragItem);
      let snapped = false;
      blocks.forEach(b => {
        const r1 = b.getBoundingClientRect();
        const r2 = dragItem.getBoundingClientRect();
        if (Math.abs(r2.left - r1.left) < 20 && Math.abs(r2.top - (r1.top + r1.height + 5)) < 20) {
          dragItem.style.left = r1.left + 'px';
          dragItem.style.top = (r1.top + r1.height + 5) + 'px';
          snapped = true;
        }
      });
      if (!snapped) {
        // leave free-floating
      }
      dragItem = null;
    });
  </script>
</body>
</html>
